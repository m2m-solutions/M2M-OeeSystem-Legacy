namespace M2M.DataCenter.Reports
{
    using System;
    using System.ComponentModel;
    using System.Drawing;
    using System.Windows.Forms;
    using Telerik.Reporting;
    using Telerik.Reporting.Drawing;
    using Telerik.Reporting.Charting;
    using M2M.DataCenter.Utilities;
using System.Collections;
    using System.Globalization;
    using System.Collections.Generic;

    /// <summary>
    /// Summary description for Machine.
    /// </summary>
    [Description("Innehåller nyckeltal (TAK) för en enskild maskin")]
    [DisplayName("Månadsrapport - TAK på maskinnivå")]
    public partial class MachineOeeMonthly : Telerik.Reporting.Report
    {
        #region Properties

        MachineOee m_OeeData = null;
       
        #endregion

        public MachineOeeMonthly()
        {
            /// <summary>
            /// Required for telerik Reporting designer support
            /// </summary>
            InitializeComponent();

            this.ReportParameters["DivisionId"].UI.AvailableValues.DataSource = M2MDataCenter.GetDivisionList();
            this.ReportParameters["DivisionId"].UI.AvailableValues.ValueMember = "DivisionId";
            this.ReportParameters["DivisionId"].UI.AvailableValues.DisplayMember = "DisplayName";

            this.ReportParameters["MachineId"].UI.AvailableValues.DataSource = M2MDataCenter.GetMachineList();
            this.ReportParameters["MachineId"].UI.AvailableValues.ValueMember = "MachineId";
            this.ReportParameters["MachineId"].UI.AvailableValues.DisplayMember = "DisplayName";
            this.ReportParameters["MachineId"].UI.AvailableValues.Filters.AddRange(new Telerik.Reporting.Data.Filter[] {
            new Telerik.Reporting.Data.Filter("=Fields.DivisionId", Telerik.Reporting.Data.FilterOperator.Equal, "=Parameters.DivisionId")});

            ArrayList years = new ArrayList();
            for(int i=DateTime.Today.Year; i >= 2005; i--)
            {
                years.Add(i);
            }
            this.ReportParameters["Year"].UI.AvailableValues.DataSource = years;
            this.ReportParameters["Year"].UI.AvailableValues.ValueMember = "Item";
            
            SortedList months = new SortedList();
            for (int i = 1; i <= 12; i++)
            {
                months.Add(i, String.Format("{0:dMM}", new DateTime(2009, i, 1).ToString("MMMM")));
            }
            
            this.ReportParameters["Month"].UI.AvailableValues.DataSource = months;
            this.ReportParameters["Month"].UI.AvailableValues.ValueMember = "Key";
            this.ReportParameters["Month"].UI.AvailableValues.DisplayMember = "Value";

            this.ReportParameters["ShiftType"].UI.AvailableValues.DataSource = EnumHelper.ToList2(typeof(ShiftType));
            this.ReportParameters["ShiftType"].UI.AvailableValues.ValueMember = "Value";
            

            this.ReportParameters["Year"].Value = DateTime.Today.Year;
            this.ReportParameters["Month"].Value = DateTime.Today.AddMonths(-1).Month;
            this.ReportParameters["ShiftType"].Value = EnumHelper.GetDescription2(ShiftType.NotDefined);

            
        }

        private void Machine_NeedDataSource(object sender, EventArgs e)
        {
            string divisionId = (string)ReportParameters["DivisionId"].Value;
            string machineId = (string)ReportParameters["MachineId"].Value;
            ShiftType shift = (ShiftType)Enum.Parse(typeof(ShiftType), EnumHelper.GetKey2(typeof(ShiftType), (string)ReportParameters["ShiftType"].Value));
            DateTime startDate = new DateTime((int)ReportParameters["Year"].Value, (int)ReportParameters["Month"].Value, 1);
            DateTime endDate = startDate.AddMonths(1);
            if (endDate > DateTime.Today)
                endDate = DateTime.Today;
            m_OeeData = new MachineOee(divisionId, machineId, shift, startDate, endDate);
            
            (sender as Telerik.Reporting.Processing.Report).DataSource = m_OeeData;
            
        }

        private void chartTotalOee_NeedDataSource(object sender, EventArgs e)
        {
            (sender as Telerik.Reporting.Processing.Chart).DataSource = m_OeeData.GetTotalData();
        }

        private void chartPeriodicOee_NeedDataSource(object sender, EventArgs e)
        {
            (sender as Telerik.Reporting.Processing.Chart).DataSource = m_OeeData.GetPeriodicData(Intervals.Daily);
        }

        private void listArticles_NeedDataSource(object sender, EventArgs e)
        {
            (sender as Telerik.Reporting.Processing.Table).DataSource = m_OeeData.GetArticleData();
        }


        private void tableArticles_NeedDataSource(object sender, EventArgs e)
        {
            (sender as Telerik.Reporting.Processing.Table).DataSource = m_OeeData.GetArticleData();
        }

        private void table1_NeedDataSource(object sender, EventArgs e)
        {
            
        }

        private void list1_NeedDataSource(object sender, EventArgs e)
        {
            (sender as Telerik.Reporting.Processing.Table).DataSource = m_OeeData.GetTotalData();
        }
    }
}